@{
    ViewBag.Title = "Home Page";
}

<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/JsNet/System.debug.js"></script>
<script src="~/Scripts/JsNet/System.IO.debug.js"></script>
<script src="~/Scripts/JsNet/System.Text.debug.js"></script>
<script src="~/Scripts/JsNet/System.Convert.debug.js"></script>
<script src="~/Scripts/jsnet/System.BigInt.debug.js"></script>
<script src="~/Scripts/JsNet/System.BitConverter.debug.js"></script>
<script src="~/Scripts/JsNet/System.Security.Cryptography.debug.js"></script>
<script src="~/Scripts/JsNet/System.Security.Cryptography.SHA1.debug.js"></script>
<script src="~/Scripts/JsNet/System.Security.Cryptography.HMACSHA1.debug.js"></script>
<script src="~/Scripts/JsNet/System.Security.Cryptography.RSA.debug.js"></script>

<script>
    console.log($);
    window.jQuery(function() {
        //alert("JSQUERY")


        var pukey  = @(Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.PublicKeyXml)))
        console.log(pukey);
        //console.log(prkey);

        //var encrypt = new JSEncrypt();
        //debugger;
        // encrypt.setPublicKey(pukey.Modulus);
        //var encryptedData = encrypt.encrypt("123");
        //console.log(encryptedData);

        debugger;
        // Text to encrypt and decrypt.
        var text = "plain text";
        // Use OAEP padding (PKCS#1 v2).
        var doOaepPadding = false;
        // RSA 512-bit key: Public (Modulus), Private (D) and CRT (P, Q, DP, DQ, InverseQ).
        var xmlParams = pukey;
        //"<RSAKeyValue>" +
        //    "<Modulus>pxtmFnrGI6Sb8ziyY+NRUDuQ4b/ETw5WabQ4daFQqzsCEr/6J/LLBU/2D5mO5/Wu5U/Rya1E55aYFZeaZMNqAw==</Modulus>" +
        //    "<Exponent>AQAB</Exponent>" +
        //    "<P>2TsVXWPEvDIJv/gd2rX9k0UOyXuaYgoAchIH6vUicis=</P>" +
        //    "<Q>xO4+OYREQfqYRQK7y73+RaUG0IxobT0OQ0c+Ok2hc4k=</Q>" +
        //    "<DP>K7/xgpiIU9rECeyfnp/OjS14V+3T3vDivBaTj6eFI3c=</DP>" +
        //    "<DQ>K4N9ClZ4gp+tn6oP9t//XEIvtEsiE+kmyqTmUhmvMAk=</DQ>" +
        //    "<InverseQ>p7o4BOlKZQZ693R1ViZ66y5gTjUkNNTd2za7/1YGBCs=</InverseQ>" +
        //    "<D>XZqFVrYy4qhECruJgVZFp/GVuD5Y0gev88nVjl5r911QT+I8vgJSklTso7jTlpMtf2oe7UZ0WRWEtgPS3tZn4Q==</D>" +
        //    "</RSAKeyValue>";
        // ------------------------------------------------
        // RSA Keys
        // ------------------------------------------------
        var rsa = new System.Security.Cryptography.RSACryptoServiceProvider();
        // Import parameters from XML string.
        rsa.FromXmlString(xmlParams);
        // Export RSA key to RSAParameters and include:
        //    false - Only public key required for encryption.
        //    true  - Private key required for decryption.
        // Export parameters and include only Public Key (Modulus + Exponent)
        // required for encryption.
        var rsaParamsPublic = rsa.ExportParameters(false);
        // Export Public Key (Modulus + Exponent) and include Private Key (D)
        // required for decryption.
        //var rsaParamsPrivate = rsa.ExportParameters(true);
        // ------------------------------------------------
        // Encrypt
        // ------------------------------------------------
        var decryptedBytes = System.Text.Encoding.UTF8.GetBytes(text);
        // Create a new instance of RSACryptoServiceProvider.
        rsa = new System.Security.Cryptography.RSACryptoServiceProvider();
        // Import the RSA Key information.
        rsa.ImportParameters(rsaParamsPublic);
        // Encrypt byte array.
        var encryptedBytes = rsa.Encrypt(decryptedBytes, doOaepPadding);
        // Convert bytes to base64 string.

        debugger;
        var base64String = btoa(String.fromCharCode.apply(null, new Uint8Array(encryptedBytes)));

        var encryptedString = System.Convert.ToBase64String(encryptedBytes);

        var data = encryptedBytes.join(",");
        console.log(data);
       // return;
        $.ajax({
            "url": "@Url.Action("SaveData","Home")",
            "type": "POST",
            "data": { data: data },
            "success": function(result) {
                alert(result);
            }
        });

    });
    // ------------------------------------------------
    // Decrypt
    // ------------------------------------------------
    // Convert base64 string back to bytes.
    //encryptedBytes = System.Convert.FromBase64String(encryptedString);
    //// Create a new instance of RSACryptoServiceProvider.
    //rsa = new System.Security.Cryptography.RSACryptoServiceProvider();
    //// Import the RSA Key information.
    //rsa.ImportParameters(rsaParamsPrivate);
    //// Decrypt byte array.
    //decryptedBytes = rsa.Decrypt(encryptedBytes, doOaepPadding);
    //// Get decrypted data.
    //text = System.Text.Encoding.UTF8.GetString(decryptedBytes);
    //// ------------------------------------------------
    //// Generate new RSA Key pair
    //// ------------------------------------------------
    //// Specify RSA key size.
    //var keySize = 512;
    //// Create a new instance of RSACryptoServiceProvider.
    //rsa = new System.Security.Cryptography.RSACryptoServiceProvider(keySize);
    //// Export the RSA Key information as XML string.
    ////    false - Only public key required for encryption.
    ////    true  - Private key required for decryption.
    //xmlParams = rsa.ToXmlString(true);


</script>

<div class="jumbotron">
    <h1>ASP.NET</h1>
    <p class="lead">ASP.NET is a free web framework for building great Web sites and Web applications using HTML, CSS and JavaScript.</p>
    <p><a href="http://asp.net" class="btn btn-primary btn-lg">Learn more &raquo;</a></p>
</div>

<div class="row">
    <div class="col-md-4">
        <h2>Getting started</h2>
        <p>
            ASP.NET MVC gives you a powerful, patterns-based way to build dynamic websites that
            enables a clean separation of concerns and gives you full control over markup
            for enjoyable, agile development.
        </p>
        <p><a class="btn btn-default" href="http://go.microsoft.com/fwlink/?LinkId=301865">Learn more &raquo;</a></p>
    </div>
    <div class="col-md-4">
        <h2>Get more libraries</h2>
        <p>NuGet is a free Visual Studio extension that makes it easy to add, remove, and update libraries and tools in Visual Studio projects.</p>
        <p><a class="btn btn-default" href="http://go.microsoft.com/fwlink/?LinkId=301866">Learn more &raquo;</a></p>
    </div>
    <div class="col-md-4">
        <h2>Web Hosting</h2>
        <p>You can easily find a web hosting company that offers the right mix of features and price for your applications.</p>
        <p><a class="btn btn-default" href="http://go.microsoft.com/fwlink/?LinkId=301867">Learn more &raquo;</a></p>
    </div>
</div>